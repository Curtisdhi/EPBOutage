{% extends '::layout.html.twig' %}

{% block javascript %}
    <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&callback=initMap"></script>
    <script>
        var mapReady = true;
        var mapLoaded = false;
        var outageMap = null;
        function initMap() {
            loadMap();
        }
 
        function loadMap() {
            if (!mapLoaded && outageMap) {
                outageMap.load();
                outageMap.loadOutageData();
                mapLoaded = true;
            }
        }
        
        $(document).ready(function () {
            var map = $('#map');
            var metricsTableElement = $('#metrics-table > tbody');
            outageMap = new OutageMap(map, metricsTableElement, map.data('zoom'), map.data('center-location'));
            loadMap();
        });
    </script>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-10">
            <div id="map" data-zoom="{{ google_map.zoom }}" data-center-location="{{ google_map.center_location|json_encode() }}"></div>
        </div>
        <div class="col-md-2">
            <h3>Metrics</h3>
            <table id="metrics-table" class="table table-striped">
                <tbody></tbody>
            </table>
        </div>
    </div>
{% endblock %}